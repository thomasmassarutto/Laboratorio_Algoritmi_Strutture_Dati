---
title: "Periodo frazionario"
author: "Thomas Massarutto"
date: "2023-08-17"
output:
  pdf_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r functions, include=FALSE}
##
## raccolta di funzioni utili
##

library(ggplot2)
library(dplyr)
library(grid)
library(gridExtra)
results <-read.csv("results2.csv")

## plotta una singola run 
smallPlotRun<-function(idRun){
  
  runDataSet= filter(results,Run == idRun)
  
  # Creazione del grafico a pallini
  ggplot(runDataSet, 
         aes(x = String.Length, 
             y = Duration, 
             color = Algorithm.Type)) +
    
    geom_point() +
    
    scale_color_manual(values = c("naive" = "red", 
                                  "smart" = "blue")) +
    
    scale_y_continuous(labels = scales::label_number(scale = 1e-6, suffix = "M"),
                       name = "Nanosecondi") +
    
    scale_x_continuous(labels = scales::label_number(scale = 1e-3, suffix = "K"),
                       name = "Lunghezza stringa") +
    
    theme(legend.position="none")
  
}
#####

## Calcola la media delle run
## ritorna dataset con 2 colonne: string.Length, avg_duration
average <-function(algo){
  # Filtra i risultati per l'algoritmo 
  algo_results <- results %>%
    filter(Algorithm.Type == algo)
  
  # Imposta l'opzione per la notazione esponenziale
  options(scipen = 999)
  
  # Raggruppa per lunghezza della stringa e calcola la media della durata
  average_duration_by_length <- algo_results %>%
    group_by(String.Length) %>%
    summarise(avg_duration = mean(Duration))
  
  return (average_duration_by_length)
}
#####

# Definizione della funzione per il plot delle prime 20 righe
plot_first_30 <- function(data, point_color) {
  # Prende solo le prime 20 righe
  subset_data <- head(data, 30)
  
  # Creazione del grafico
  ggplot(subset_data, aes(x = String.Length, y = avg_duration)) +
    geom_point(color = point_color) +
    labs(title = "Primi 30 dati: Durata media vs Lunghezza della stringa",
         x = "Lunghezza della stringa",
         y = "Durata media")
}

```


```{r 6runs , echo=FALSE}
##
## plot delle 5 run di raccolta dati eseguite
##
run1<- smallPlotRun(1)
run2<- smallPlotRun(2)
run3<- smallPlotRun(3)
run4<- smallPlotRun(4)
run5<- smallPlotRun(5)
run6<- smallPlotRun(6)




grid.arrange(run1, run2, run3, run4, run5, run6, 
             ncol = 2, nrow = 3, 
             top=textGrob("Durata vs Lunghezza della stringa"))


```

```{r averagerun, echo=FALSE}
naive <- average("naive")
smart <- average("smart")
summary(naive)
summary(smart)


# Creazione del grafico a pallini
ggplot(naive, 
       aes(x = String.Length, 
           y = avg_duration 
       )) +
  
  geom_point(color='red') +
  
  scale_x_log10() +  # Scala logaritmica sull'asse x
  scale_y_log10() +  # Scala logaritmica sull'asse y
  
  labs(title = "Durata vs Lunghezza della stringa",
       x= "Lunghezza della stringa",
       y="Durata (nanosecondi)"
  )

# Creazione del grafico a pallini
ggplot(smart, 
       aes(x = String.Length, 
           y = avg_duration 
       )) +
  scale_x_log10() +  # Scala logaritmica sull'asse x
  scale_y_log10() +  # Scala logaritmica sull'asse y
  
  geom_point(color='blue') +
  
  
  labs(title = "Durata vs Lunghezza della stringa",
       x= "Lunghezza della stringa",
       y="Durata (nanosecondi)",
  )
```


```{r log , echo=FALSE}
##
## display dei primi 20 elementi
##
plot_first_30(naive, "red")
plot_first_30(smart, "blue")


```

```{r reg , echo=FALSE}
delta_time <- data.frame(
  String.Length = naive$String.Length,  # Copia la colonna String.Length da naive
  naive_avg_duration= naive$avg_duration,
  smart_avg_duration= smart$avg_duration,
  avg_delta_duration = naive$avg_duration - smart$avg_duration,  # Calcola la differenza delle durate
  avg_delta_duration_millis = (naive$avg_duration - smart$avg_duration)/ 100000  # millisecondi
)

summary(delta_time)

# Indici delle righe desiderate
indices <- c(1, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100)

# Seleziona le righe dal dataframe delta_time
selected_rows <- delta_time[indices, ]
print(selected_rows)

```

```{r reg2 , echo=FALSE}
library(dplyr)

# Raggruppa il dataframe in intervalli di dimensione 10
delta_time_grouped <- delta_time %>%
  mutate(Group = ceiling(row_number() / 5)) %>%
  group_by(Group) %>%
  summarize(
    String.Length = paste(first(String.Length), last(String.Length), sep = "-"),
    
    naive_avg_duration= mean(naive$avg_duration[Group]),
    smart_avg_duration= mean(smart$avg_duration[Group]),
    
    avg_delta_duration = mean(avg_delta_duration),
    avg_delta_duration_millis = mean(avg_delta_duration_millis)
  )

print(delta_time_grouped)


```